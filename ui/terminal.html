<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1">
		<meta name="apple-mobile-web-app-status-bar-style" content="#000000">
		<meta name="msapplication-navbutton-color" content="#000000">
		<meta name="theme-color" content="#000000">
		<title></title>
		<link rel="stylesheet" href="/assets/images/favicon.png">
		<link rel="stylesheet" href="/assets/css/fonts.css">
		<link rel="stylesheet" href="/assets/css/menu.css">
		<link rel="stylesheet" href="/assets/css/animations-terminal.css">
		<link rel="stylesheet" href="/assets/css/terminal.css">
		<link rel="stylesheet" href="/assets/css/colors.css">
	</head>
	<base target="_blank">
	<body>
		<img class="/assets/images/link.svg"></img>
		<img class="/assets/images/home.svg"></img>
		<img class="/assets/images/server.svg"></img>
		<img class="/assets/images/key.svg"></img>
		<img class="/assets/images/pause.svg"></img>
		<img class="/assets/images/stop.svg"></img>
		<img class="/assets/images/endallstreams.svg"></img>
		<img class="/assets/images/snapmon.svg"></img>
		<img class="/assets/images/streammon.svg"></img>
		<img class="/assets/images/streammic.svg"></img>
		<img class="/assets/images/eye.svg"></img>
		<img class="/assets/images/proxy.svg"></img>
		<img class="/assets/images/proxy-icon.svg"></img>
		<img class="/assets/images/session.svg"></img>
		<img class="/assets/images/newwindow.svg"></img>
		<img class="/assets/images/selectall.svg"></img>
		<img class="/assets/images/clear.svg"></img>
		<div class="menu">
			<div class="item left online" name="statusled" title="Status: Online"></div>
			<!-- <div class="item left" name="newwindow" title="Open new terminal">
				<div class="icon newwindow"></div>
			</div> -->
			<!-- <div class="item left no-click" name="session">
				<div class="icon session"></div>
				<div class="submenu">
					<div class="subitem" title="Change session encryption key"><div class="icon lock"></div><span>&nbsp;Session&nbsp;encryption</span></div>
					<div class="subitem" title="Set a timer to pause all connections to session"><div class="icon pause"></div><span>&nbsp;Pause&nbsp;session</span></div>
					<div class="subitem" title="Quit interpreter? (Y/n)"><div class="icon stop"></div><span>&nbsp;End&nbsp;session</span></div>
				</div>
			</div> -->
			<!-- <div class="item left no-click" name="proxy">
				<div class="icon proxy-icon"></div>
				<div class="submenu">
					<div class="subitem" title="Set a proxy(chain)/VPN to connect with relay"><div class="icon proxy-icon"></div>&nbsp;Relay&nbsp;proxy</div>
					<div class="subitem" title="Set a proxy(chain)/VPN to connect with interpreter"><div class="icon proxy-icon"></div>&nbsp;Interpreter&nbsp;proxy</div>
				</div>
			</div> -->
			<div class="item left no-click" name="settings" title="Preferences">
				<div class="icon settings"></div>
				<div class="submenu">
					<div class="subitem"></div>
					<div class="subitem"></div>
					<div class="subitem"></div>
					<div class="subitem"></div>
					<div class="subitem"></div>
				</div>
			</div>
			<div class="item left" name="javascript" title="Execute JavaScript">
				<div class="icon javascript"></div>
				<input type="text" name="jsfield" placeholder="Enter code...">
			</div>
			<div class="item left no-cursor no-hover no-click no-right-border" title="Network activity">
				<div class="network-indicator lds-ellipsis">
					<div></div>
					<div></div>
					<div></div>
					<div></div>
				</div>
			</div>
			<div class="item right" name="clear" title="Clear">
				<div class="icon clear"></div>
			</div>
			<!-- <div class="item right" name="fingerprint" title="Simulate device controls">
				<div class="icon fingerprint"></div>
			</div> -->
			<div class="item right no-click no-left-border" name="plugins" title="Plugins">
				<div class="icon plug"></div>
				<div class="submenu">
					<div class="subitem" title="Stream microphone through a websocket of relay.">
						<div class="icon streammic">
							<div class="icon rec"></div>
						</div>
						&nbsp;Stream&nbsp;microphone
					</div>
					<div class="subitem" title="Stream webcam through a websocket of relay.">
						<div class="icon eye">
							<div class="icon rec"></div>
						</div>
						&nbsp;Stream&nbsp;webcam
					</div>
					<div class="subitem" title="Take a picture with webcam.">
						<div class="icon eye"></div>
						&nbsp;Capture&nbsp;webcam&nbsp;shot
					</div>
					<div class="subitem" title="Stream screen through a websocket of relay.">
						<div class="icon streammon">
							<div class="icon rec"></div>
						</div>
						&nbsp;Stream&nbsp;monitor
					</div>
					<div class="subitem" name="yungtravla-terminal-linux-gnome-screenshot" title="Take a screenshot.">
						<div class="icon streammon"></div>
						&nbsp;Capture&nbsp;screenshot
					</div>
				</div>
			</div>
			<!-- <div class="item right no-click no-left-border" name="proxy" title="Proxy">
				<div class="icon proxy-icon"></div>
				<div class="submenu">
					<div class="subitem" title="Configure proxy between you and relay"><div class="icon proxy-icon"></div>&nbsp;sewers&nbsp;proxy</div>
					<div class="subitem" title="Configure proxy between relay and interpreter"><div class="icon proxy-icon"></div>&nbsp;Interpreter&nbsp;proxy</div>
				</div>
			</div> -->
			<!-- <div class="item right" name="selectall" title="Select all">
				<div class="icon selectall"></div>
			</div>
			<div class="item right" name="endallstreams" title="End all streams">
				<div class="icon endallstreams">
					<div class="icon rec off"></div>
				</div>
			</div>
			<div class="item right" name="streammic" title="Stream microphone">
				<div class="icon streammic">
					<div class="icon rec"></div>
				</div>
			</div>
			<div class="item right" name="streamcam" title="Stream webcam">
				<div class="icon eye">
					<div class="icon rec"></div>
				</div>
			</div>
			<div class="item right" name="snapcam" title="Capture webcam">
				<div class="icon eye"></div>
			</div>
			<div class="item right" name="streammon" title="Stream monitor">
				<div class="icon streammon">
					<div class="icon rec"></div>
				</div>
			</div>
			<div class="item right no-left-border" name="snapmon" title="Capture screenshot">
				<div class="icon streammon"></div>
			</div> -->
		</div>
		<div class="scrollBox">
			<div class="terminal"></div>
			<div class="background"></div>
		</div>
		<form>
			<div class="loadline stop"></div>
			<textarea name="cmd"></textarea>
			<!-- <input type="button" name="button" value="ENTER"> -->
		</form>
		<div class="buffer"></div>
	</body>
	<script>

		// Set variables
		const form = document.querySelector("html body form"),
		      textarea = document.querySelector("html body form textarea"),
		      scrollBox = document.querySelector("html body div.scrollBox"),
		      terminal = document.querySelector("html body div.scrollBox div.terminal"),
		      jsfield = document.querySelector("html body div.menu div.item[name=javascript] input")

		let session_config = {},
		    relay_config = {}

		let autoFetch = async () => {},
		    autoFetchSession,
		    fetch_delay = 1000,
		    auto_fetching = false,
		    fetch_on_auto_fetch_start = true

		let load_line = document.querySelector("html body form div.loadline")

		let relay = location.href.replace(/.*\/terminal\//g, "").replace(/\/.*/g, ""),
		    session_id = location.href.replace(/.*\//g, "")

		let request_tag = "<span class=\"orange bold\">sewers</span> \xBB ",
		    response_tag = "<span class=\"cyan bold\">interpreter</span> \xBB "

		let request

		let onResponse = async () => {}

		let active_streams = new Array()

		let allowed_characters = " !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz".split("")

		let cmd_history = new Array(),
		    cmd_history_i = 0,
		    cmd_current = ""

		let linebreaks,
		    clearBreaks = parseInt( scrollBox.getBoundingClientRect().height / 12 )

		let warnBeforeClose = true,
		    warnOnReset = false,
		    scrollOnInput = true,
		    scrollOnOutput = true,
		    scrollOnScrolledOutput = false,
		    scrollOnJsInput = false,
		    mic_bitrate = "16000",
		    mon_bitrate = "512000",
		    mon_resolution = "1280x800"
		    cam_bitrate = "512000",
		    cam_resolution = "1280x800"

	</script>
	<script src="/assets/js/transport.js"></script>
	<script src="/assets/js/functions-terminal.js"></script>
	<script src="/assets/js/events-terminal.js"></script>
	<!-- <script src="/plugins/ui/terminal/commands.js"></script> -->
	<script>

		// plugin debug
		// terminal-commands.json

			commands = {
				"clear": {
					"category": "Terminal",
					"arguments": [],
					"description": ""
				},
				"exit": {
					"category": "Terminal",
					"arguments": [],
					"description": ""
				},
				"fetchrate": {
					"category": "Interpreter",
					"arguments": ["MIN SECONDS", "MAX SECONDS"],
					"description": "Set automatic fetch rate of interpreter."
				}
			}

		// plugin debug
		// gnome-screenshot.js

			document.querySelector("html body div.menu div.subitem[name=yungtravla-terminal-linux-gnome-screenshot]").addEventListener("click", async()=>{
				let os_string = session_config.os

				if ( os_string.match("GNU/Linux") ) {
					let time = await timestamp()

					print( request_tag + "<span title=\"" + time + "\">Capturing screenshot...<br></span>" )

					let filename = await randomString(8, 16)
					let command = "sh gnome-screenshot -p -f ./" + filename + ".png &> /dev/null && cat ./" + filename + ".png && rm ./" + filename + ".png"

					parseCommand(command)
				}
			})

	</script>
	<script src="/assets/js/initiate-terminal.js"></script>
</html>
